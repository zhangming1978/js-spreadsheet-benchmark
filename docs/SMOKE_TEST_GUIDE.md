# 冒烟测试使用指南

## 什么是冒烟测试？

冒烟测试是一种快速验证软件基本功能的测试方法。在本项目中，冒烟测试会自动验证所有 6 个表格产品的基本功能是否正常工作。

## 为什么需要冒烟测试？

- ✅ **快速验证**: 2-3 分钟内完成所有产品的基本功能测试
- ✅ **无需 UI**: 命令行运行，不需要手动操作界面
- ✅ **自动化**: 适合集成到 CI/CD 流程
- ✅ **早期发现问题**: 在开发过程中快速发现集成问题

## 使用场景

### 1. 开发过程中验证

```bash
# 修改代码后，快速验证是否破坏了现有功能
npm run smoke-test
```

### 2. 提交代码前检查

```bash
# 确保所有产品适配器正常工作
git add .
npm run smoke-test
git commit -m "feat: add new feature"
```

### 3. CI/CD 集成

在 GitHub Actions、GitLab CI 等 CI/CD 流程中运行：

```yaml
- name: Run smoke tests
  run: npm run smoke-test
```

### 4. 调试特定产品问题

```bash
# 以有头模式运行，可以看到浏览器窗口
npm run smoke-test:headed
```

## 测试内容

冒烟测试会验证每个产品的：

1. **初始化**: 产品能否正常初始化
2. **数据加载**: 能否加载 100 行测试数据
3. **基本渲染**: 数据是否正确显示

## 测试结果

### 成功示例

```
Running 3 tests using 1 worker

  ✓ [chromium] › smoke-test.spec.ts:8:3 › 冒烟测试 › 手动运行冒烟测试 (6.6s)
  ✓ [chromium] › smoke-test.spec.ts:36:3 › 冒烟测试 › 自动冒烟测试功能 (2.1m)
  ✓ [chromium] › smoke-test.spec.ts:57:3 › 冒烟测试 › 冒烟测试结果验证 (6.7s)

  3 passed (2.4m)
```

### 失败示例

如果某个产品测试失败，会显示详细错误信息：

```
  ✗ [chromium] › smoke-test.spec.ts:36:3 › 冒烟测试 › 自动冒烟测试功能

    Error: Luckysheet 初始化失败: jQuery mousewheel plugin is not loaded
```

## 查看详细报告

测试完成后，可以查看 HTML 报告：

```bash
npm run test:report
```

报告包含：
- 每个测试的执行时间
- 失败测试的截图
- 详细的错误堆栈
- 测试执行的视频（失败时）

## 常见问题

### Q: 冒烟测试和完整测试有什么区别？

A:
- **冒烟测试**: 快速验证基本功能，使用小数据集（100 行），耗时 2-3 分钟
- **完整测试**: 测试所有场景和功能，使用大数据集（1000-10000 行），耗时 5-10 分钟

### Q: 冒烟测试失败了怎么办？

A:
1. 查看错误信息，确定是哪个产品失败
2. 运行 `npm run smoke-test:headed` 查看浏览器中的实际情况
3. 检查该产品的适配器代码
4. 查看浏览器控制台日志

### Q: 可以只测试特定产品吗？

A: 当前冒烟测试会测试所有产品。如果需要测试特定产品，可以：
1. 使用完整的 UI 界面手动测试
2. 修改 `tests/e2e/smoke-test.spec.ts` 文件，注释掉不需要测试的产品

### Q: 冒烟测试需要启动开发服务器吗？

A: 不需要。Playwright 会自动启动开发服务器。但如果服务器已经在运行，测试会复用现有服务器。

## 最佳实践

1. **每次提交前运行**: 确保代码变更不会破坏现有功能
2. **集成到 CI/CD**: 自动化验证每次代码提交
3. **定期运行**: 即使没有代码变更，也定期运行以确保环境正常
4. **结合完整测试**: 冒烟测试通过后，再运行完整的性能测试

## 技术细节

冒烟测试使用 Playwright 框架：
- 自动启动 Chromium 浏览器
- 在隔离的测试环境中运行
- 自动清理测试数据
- 生成详细的测试报告

测试文件位置：`tests/e2e/smoke-test.spec.ts`
