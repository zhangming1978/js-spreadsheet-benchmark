# SpreadJS 性能对比 Demo 需求规格说明书

## 1. 项目概述

### 1.1 项目背景
在电子表格组件市场中，SpreadJS 面临来自开源方案（Univer）和商业竞品（Handsontable）的竞争。为了向潜在客户和现有用户展示 SpreadJS 的性能优势，需要开发一个直观、可信的性能对比演示页面。

### 1.2 项目目标
- 通过客观的性能测试数据，展示 SpreadJS 在关键场景下的性能优势
- 提升潜在客户对 SpreadJS 产品的信心和购买意愿
- 为销售团队提供有力的技术支撑材料
- 增强品牌在技术社区的影响力和可信度

### 1.3 目标用户
- **主要用户**：正在评估电子表格组件的技术决策者（CTO、技术经理、架构师）
- **次要用户**：前端开发者、产品经理、销售团队

---

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 产品选择器
- 支持同时选择 2-3 个产品进行对比
- 默认选中：SpreadJS vs Univer vs Handsontable
- 支持单独查看某一产品的性能表现
- 显示各产品的版本信息

#### 2.1.2 测试场景选择
提供以下核心测试场景：

**A. 数据加载性能**
- 小数据集：1,000 行 × 10 列
- 中数据集：10,000 行 × 20 列
- 大数据集：50,000 行 × 50 列
- 超大数据集：100,000 行 × 100 列

**B. 滚动性能**
- 垂直滚动流畅度（FPS）
- 水平滚动流畅度（FPS）
- 大数据集下的滚动响应时间

**C. 编辑操作性能**
- 单元格编辑响应时间（模拟输入 100 次）
- 批量数据粘贴（1000 单元格，模拟 Ctrl+V）
- 批量数据填充（自动填充 1000 单元格，模拟序列填充）
- 批量单元格样式修改（1000 单元格）
- 撤销/重做操作响应时间（连续 50 次操作）

**D. 公式计算性能**
- 简单公式计算（SUM, AVERAGE）- 10,000 个公式
- 复杂公式计算（VLOOKUP, INDEX/MATCH）- 1,000 个公式
- 公式链式依赖计算
- 公式重算性能

**E. 渲染性能**
- 初始渲染时间
- 条件格式渲染（1,000 条规则）
- 图表渲染（10 个图表）
- 样式切换响应时间

**F. 内存占用**
- 空白工作簿内存占用
- 加载 10,000 行数据后的内存占用
- 加载 100,000 行数据后的内存占用
- 内存泄漏测试（长时间操作后的内存变化）

**G. Excel 文件导入性能**
- 用户上传 Excel 文件（.xlsx）
- 测试从文件选择到完全加载并渲染的时间
- 支持任意大小的文件，由用户自行决定
- 显示文件解析时间和渲染时间的分解
- 提供不同规模的示例文件供用户快速测试：
  - 小文件示例：约 1,000 行数据
  - 中文件示例：约 10,000 行数据
  - 大文件示例：约 50,000 行数据

#### 2.1.3 测试自动化与可视化

**自动化执行方案**：
所有测试均通过 API 调用自动执行，无需人工干预：

- **数据加载**：使用 `setDataSource()` 或等效 API 加载预生成的测试数据
- **滚动操作**：使用 `scrollTo()` API 模拟滚动，监控 FPS
- **编辑操作**：
  - 单元格编辑：使用 `setValue()` API 循环设置单元格值
  - 批量粘贴：使用 `setArray()` 或 `setRange()` API 批量设置数据
  - 批量填充：使用 `fillAuto()` 或等效 API 执行自动填充
  - 样式修改：使用 `setStyle()` API 批量修改样式
  - 撤销/重做：调用 `undo()` / `redo()` API
- **公式计算**：使用 `setFormula()` API 批量设置公式，监控计算时间
- **渲染操作**：使用 `addConditionalFormat()`, `addChart()` 等 API
- **Excel 导入**：
  - 用户通过文件选择器上传 Excel 文件
  - 使用 `importExcel()` 或 `open()` API 导入文件
  - 测量从文件读取开始到完全渲染完成的总时间
  - 分别记录文件解析时间和渲染时间
  - 提供预置的示例文件供快速测试

**可视化展示方案**：

1. **实时操作预览区**（可选显示/隐藏）
   - 在页面右侧显示一个缩小版的表格实例
   - 实时展示当前正在执行的操作（如数据填充动画）
   - 使用高亮效果标识正在测试的区域
   - 显示当前操作的进度（如"正在填充 500/1000 单元格"）

2. **测试进度指示器**
   - 显示当前测试项名称和描述
   - 显示整体进度条（如"测试进度：5/18 项完成"）
   - 显示当前测试项的子进度（如"SpreadJS: 完成 | Univer: 进行中 | Handsontable: 等待中"）
   - 显示实时性能数据（如"当前 FPS: 58"）

3. **测试日志输出**
   - 显示测试执行日志（可折叠）
   - 记录每个测试项的开始/结束时间
   - 记录异常或警告信息
   - 支持导出日志

#### 2.1.4 实时性能测试控制
- 点击"开始测试"按钮，自动运行所有性能测试
- 支持选择"快速模式"（减少测试次数）或"完整模式"（完整测试）
- 显示测试进度条和当前测试项
- 支持中途暂停/继续测试
- 支持中途停止测试
- 测试完成后自动生成对比报告

#### 2.1.5 性能数据可视化
- **对比柱状图**：横向对比三个产品在同一指标下的表现
- **雷达图**：综合展示各产品在多维度的性能表现
- **趋势折线图**：展示不同数据规模下的性能变化趋势
- **性能评分卡**：为每个产品计算综合性能评分（0-100 分）

#### 2.1.6 测试环境信息
显示当前测试环境的关键信息：
- 浏览器类型和版本
- 操作系统
- CPU 信息（核心数）
- 内存信息
- 屏幕分辨率

#### 2.1.7 数据导出功能
- 导出测试结果为 JSON 格式
- 导出测试报告为 PDF 格式
- 导出性能图表为 PNG 图片
- 支持分享测试结果链接

### 2.2 辅助功能

#### 2.2.1 测试说明
- 每个测试场景的详细说明
- 测试方法论说明
- 性能指标解释
- 测试数据来源说明

---

## 3. 性能指标定义

### 3.1 关键性能指标（KPI）

| 指标名称 | 单位 | 说明 | 目标值（SpreadJS） |
|---------|------|------|-------------------|
| 初始加载时间 | ms | 从开始加载到首次可交互的时间 | < 500ms |
| 数据渲染时间 | ms | 加载数据到完全渲染的时间 | < 1000ms (10k行) |
| 滚动帧率 | FPS | 滚动时的帧率 | > 55 FPS |
| 编辑响应时间 | ms | 单元格编辑到界面更新的时间 | < 50ms |
| 公式计算时间 | ms | 公式计算完成的时间 | < 100ms (1k公式) |
| 内存占用 | MB | 运行时内存占用 | < 150MB (10k行) |
| 内存增长率 | % | 长时间运行后的内存增长 | < 10% |
| Excel 导入时间 | ms | Excel 文件导入并渲染完成的时间 | < 2000ms (10k行文件) |

### 3.2 测试方法
- 每个测试场景运行 3 次，取平均值
- 测试前清空浏览器缓存
- 使用 Performance API 进行精确计时
- 使用 Memory API 监控内存占用
- 使用 requestAnimationFrame 监控帧率

---

## 4. UI/UX 设计需求

### 4.1 页面布局

```
+----------------------------------------------------------+
|                    顶部导航栏                              |
|  [Logo] SpreadJS 性能对比 Demo          [文档] [联系我们]  |
+----------------------------------------------------------+
|                                                           |
|  标题：SpreadJS vs Univer vs Handsontable                   |
|  副标题：客观、透明的性能基准测试                          |
|                                                           |
+----------------------------------------------------------+
|  [产品选择区域]                                           |
|  ☑ SpreadJS (v17.x)  ☑ Univer (v0.x)  ☑ Handsontable (v14.x) |
+----------------------------------------------------------+
|  [测试场景选择]                                           |
|  ○ 全部测试  ○ 数据加载  ○ 滚动性能  ○ 编辑操作          |
|  ○ 公式计算  ○ 渲染性能  ○ 内存占用  ○ Excel导入         |
|                                                           |
|  [开始测试] [暂停] [停止] [导出报告]  [☑ 显示实时预览]   |
|  [上传 Excel 文件] 或 [使用示例文件]                      |
+----------------------------------------------------------+
|  [测试进度区域]                          [实时预览区域]   |
|  当前测试：编辑操作 - 批量填充           ┌──────────────┐ |
|  SpreadJS:    ✓ 完成 (245ms)            │ ┌──┬──┬──┐  │ |
|  Univer:      ⟳ 进行中... (已用 890ms)  │ │✓ │✓ │✓ │  │ |
|  Handsontable: ⏸ 等待中                 │ ├──┼──┼──┤  │ |
|                                          │ │✓ │⟳ │  │  │ |
|  整体进度：████████░░░░░░░░░░ 45%       │ └──┴──┴──┘  │ |
|  实时 FPS: 58 | 内存: 125MB              │ 正在填充...  │ |
|                                          └──────────────┘ |
|  [测试日志] (可折叠)                                      |
|  ▼ 14:23:45 [INFO] 开始测试：编辑操作性能                |
|    14:23:46 [INFO] SpreadJS 批量填充完成: 245ms         |
|    14:23:47 [WARN] Univer 响应较慢...               |
+----------------------------------------------------------+
|  [性能对比图表区域]                                       |
|  +----------------------+  +----------------------+       |
|  |   柱状对比图          |  |   雷达图              |       |
|  +----------------------+  +----------------------+       |
|  +-----------------------------------------------+       |
|  |   趋势折线图                                   |       |
|  +-----------------------------------------------+       |
+----------------------------------------------------------+
|  [详细数据表格]                                           |
|  测试项      | SpreadJS | Univer | Handsontable      |
|  ------------|----------|------------|------------------  |
|  数据加载    | 245ms ✓  | 1,230ms    | 890ms             |
|  批量填充    | 180ms ✓  | 进行中...  | 等待中            |
|  ...                                                      |
+----------------------------------------------------------+
|  [测试环境信息]                                           |
|  浏览器：Chrome 131  |  操作系统：Windows 11            |
|  CPU：8 核心         |  内存：16GB                       |
+----------------------------------------------------------+
|  [页脚]                                                   |
|  测试方法说明 | 常见问题 | 反馈建议                        |
+----------------------------------------------------------+
```

### 4.2 视觉设计要求
- **色彩方案**：
  - SpreadJS：品牌绿色 (#00A86B)
  - Univer：蓝紫色 (#6366F1)
  - Handsontable：蓝色 (#2196F3)
  - 背景：浅灰色 (#F5F5F5)

- **字体**：
  - 标题：思源黑体 / Source Sans Pro
  - 正文：微软雅黑 / Segoe UI
  - 数据：等宽字体 Consolas / Monaco

- **动画效果**：
  - 测试进度条动画
  - 图表数据加载动画
  - 页面滚动平滑过渡

### 4.3 响应式设计
- 支持桌面端（1920×1080 及以上）
- 支持平板端（768×1024）
- 移动端提示"请使用桌面浏览器访问以获得最佳体验"

### 4.4 交互设计
- 鼠标悬停在图表上显示详细数值
- 点击图例可以隐藏/显示对应产品的数据
- 支持图表缩放和拖拽
- 测试过程中禁用产品选择和场景选择

---

## 5. 技术需求

### 5.1 技术栈
- **前端框架**：React 18+ 或 Vue 3+
- **图表库**：ECharts 5+ 或 Chart.js
- **UI 组件库**：Ant Design 或 Material-UI
- **性能监控**：Performance API, Memory API
- **构建工具**：Vite 或 Webpack 5
- **代码规范**：ESLint + Prettier

### 5.2 产品集成
- SpreadJS：使用最新稳定版本（v17.x）
- Univer：使用最新社区版本（v0.x）
- Handsontable：使用社区版最新版本（v14.x）

### 5.3 性能要求
- 页面首次加载时间 < 3 秒
- 测试执行过程流畅，无明显卡顿
- 图表渲染流畅，支持大数据量展示

### 5.4 兼容性要求
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

### 5.5 自动化测试技术实现

#### 5.5.1 测试框架设计
```javascript
// 测试引擎伪代码示例
class PerformanceTestEngine {
  async runTest(product, scenario) {
    // 1. 初始化产品实例
    const instance = await this.initProduct(product);

    // 2. 预热（避免首次运行的性能损耗）
    await this.warmup(instance);

    // 3. 执行测试（运行 3 次取平均值）
    const results = [];
    for (let i = 0; i < 3; i++) {
      const result = await this.executeScenario(instance, scenario);
      results.push(result);
    }

    // 4. 计算平均值
    return this.calculateAverage(results);
  }

  async executeScenario(instance, scenario) {
    switch(scenario) {
      case 'edit-cell':
        return await this.testCellEdit(instance);
      case 'batch-paste':
        return await this.testBatchPaste(instance);
      case 'auto-fill':
        return await this.testAutoFill(instance);
      // ... 其他场景
    }
  }

  async testCellEdit(instance) {
    const startTime = performance.now();

    // 模拟 100 次单元格编辑
    for (let i = 0; i < 100; i++) {
      await instance.setValue(i, 0, `Value ${i}`);
      await this.waitForRender(); // 等待渲染完成
    }

    const endTime = performance.now();
    return endTime - startTime;
  }

  async testAutoFill(instance) {
    const startTime = performance.now();

    // 设置初始值
    await instance.setValue(0, 0, 1);
    await instance.setValue(1, 0, 2);

    // 执行自动填充（模拟拖拽填充效果）
    await instance.fillAuto(0, 0, 1, 0, 0, 0, 999, 0);
    await this.waitForRender();

    const endTime = performance.now();
    return endTime - startTime;
  }
}
```

#### 5.5.2 API 适配层
由于三个产品的 API 不同，需要创建统一的适配层：

```javascript
// 适配器模式
class SpreadJSAdapter {
  setValue(row, col, value) {
    this.sheet.setValue(row, col, value);
  }

  fillAuto(r1, c1, r2, c2, r3, c3, r4, c4) {
    const range = this.sheet.getRange(r1, c1, r2-r1+1, c2-c1+1);
    range.fillAuto(new GC.Spread.Sheets.Range(r3, c3, r4-r3+1, c4-c3+1));
  }
}

class UniverAdapter {
  setValue(row, col, value) {
    this.univerAPI.setValues([[value]], row, col);
  }

  fillAuto(r1, c1, r2, c2, r3, c3, r4, c4) {
    // Univer 的自动填充实现
    this.univerAPI.executeCommand('sheet.command.auto-fill', {
      source: { startRow: r1, startColumn: c1, endRow: r2, endColumn: c2 },
      target: { startRow: r3, startColumn: c3, endRow: r4, endColumn: c4 }
    });
  }
}

class HandsontableAdapter {
  setValue(row, col, value) {
    this.hot.setDataAtCell(row, col, value);
  }

  fillAuto(r1, c1, r2, c2, r3, c3, r4, c4) {
    // Handsontable 的自动填充实现
    this.hot.populateFromArray(/* ... */);
  }
}
```

#### 5.5.3 可视化更新机制
```javascript
class TestVisualizer {
  updateProgress(testName, productName, status, time) {
    // 更新进度条
    this.progressBar.update(percentage);

    // 更新产品状态
    this.updateProductStatus(productName, status, time);

    // 更新实时预览（如果启用）
    if (this.previewEnabled) {
      this.highlightTestArea(testName);
    }

    // 添加日志
    this.addLog(`[${new Date().toLocaleTimeString()}] ${productName} - ${testName}: ${status}`);
  }

  highlightTestArea(testName) {
    // 在预览区域高亮显示正在测试的区域
    // 例如：批量填充时，高亮显示正在填充的单元格范围
  }
}
```

### 5.6 数据存储
- 纯前端应用，无需后端服务器
- 不持久化存储测试结果（刷新页面后数据清空）
- 用户可通过导出功能保存测试结果到本地

---

## 6. 非功能需求

### 6.1 可靠性
- 测试结果必须可重现
- 测试过程中出现错误时，应有明确的错误提示
- 支持测试失败后的重试机制

### 6.2 公正性
- 所有产品使用相同的测试数据
- 所有产品使用相同的测试环境
- 测试代码开源，接受社区审查
- 明确标注各产品的版本号和测试日期

### 6.3 可维护性
- 代码结构清晰，模块化设计
- 测试用例易于扩展和修改
- 支持快速更新产品版本

### 6.4 安全性
- 不收集用户个人信息
- 测试数据不上传到服务器
- 所有计算在客户端完成

### 6.5 SEO 优化
- 页面标题、描述、关键词优化
- 使用语义化 HTML 标签
- 提供结构化数据（Schema.org）
- 生成静态 HTML 页面（SSR/SSG）

---

## 7. 内容需求

### 7.1 文案内容
- **页面标题**："SpreadJS 性能基准测试 - 与 Univer、Handsontable 的全面对比"
- **页面描述**："通过客观、透明的性能测试，全面对比 SpreadJS、Univer 和 Handsontable 在数据加载、滚动、编辑、公式计算等场景下的表现。"
- **测试方法说明**：详细说明测试环境、测试方法、数据来源
- **免责声明**：说明测试结果可能因环境差异而有所不同

### 7.2 帮助文档
- 如何解读测试结果
- 常见问题解答（FAQ）
- 测试方法论白皮书

### 7.3 多语言支持
- 中文（简体）
- 英文
- 日文（可选）

---

## 8. 项目里程碑

### 8.1 第一阶段：需求确认与设计（1 周）
- [ ] 需求评审
- [ ] UI/UX 设计稿
- [ ] 技术方案评审

### 8.2 第二阶段：核心功能开发（2 周）
- [ ] 项目框架搭建
- [ ] 产品集成（SpreadJS, Univer, Handsontable）
- [ ] 性能测试引擎开发
- [ ] 数据可视化组件开发

### 8.3 第三阶段：测试与优化（1 周）
- [ ] 功能测试
- [ ] 性能测试
- [ ] 跨浏览器兼容性测试
- [ ] 用户体验优化

### 8.4 第四阶段：上线与推广（1 周）
- [ ] 部署到生产环境
- [ ] SEO 优化
- [ ] 编写技术博客
- [ ] 社交媒体推广

---

## 9. 成功标准

### 9.1 定量指标
- 页面访问量：首月 > 5,000 UV
- 平均停留时间：> 3 分钟
- 测试完成率：> 60%
- 报告导出率：> 20%

### 9.2 定性指标
- 用户反馈积极（满意度 > 4.0/5.0）
- 销售团队认可并使用
- 技术社区正面评价

### 9.3 业务指标
- 带来至少 10 个高质量销售线索
- 提升 SpreadJS 品牌认知度
- 增加产品试用申请数量

---

## 10. 风险与应对

### 10.1 技术风险
| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 竞品版本更新导致测试结果变化 | 高 | 中 | 建立自动化测试流程，定期更新 |
| 浏览器差异导致测试结果不一致 | 中 | 高 | 明确标注测试环境，提供多浏览器测试 |
| 性能测试代码本身影响测试结果 | 高 | 低 | 代码审查，使用标准 API |
| 大数据量测试导致浏览器崩溃 | 中 | 中 | 设置合理的数据上限，提供警告提示 |

### 10.2 业务风险
| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 竞品厂商质疑测试公正性 | 高 | 中 | 开源测试代码，接受社区审查 |
| 测试结果不如预期 | 高 | 低 | 提前进行内部测试，优化 SpreadJS 性能 |
| 用户对测试方法提出质疑 | 中 | 中 | 提供详细的测试方法说明和白皮书 |

### 10.3 法律风险
| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 竞品商标使用问题 | 高 | 低 | 咨询法务，确保合规使用 |
| 测试结果引发的法律纠纷 | 高 | 低 | 添加免责声明，确保测试客观公正 |

---

## 11. 附录

### 11.1 参考资料
- [Web Performance API](https://developer.mozilla.org/en-US/docs/Web/API/Performance)
- [Chrome DevTools Performance](https://developer.chrome.com/docs/devtools/performance/)
- [Benchmark.js](https://benchmarkjs.com/)

### 11.2 竞品分析
- Univer：开源项目，现代化架构，活跃维护，功能丰富
- Handsontable：商业产品，功能丰富，性能中等

### 11.3 术语表
- **FPS**：Frames Per Second，每秒帧数
- **TTI**：Time to Interactive，首次可交互时间
- **FCP**：First Contentful Paint，首次内容绘制
- **LCP**：Largest Contentful Paint，最大内容绘制

---

## 12. 审批记录

| 角色 | 姓名 | 审批意见 | 日期 |
|------|------|---------|------|
| 产品经理 | | 待审批 | |
| 技术负责人 | | 待审批 | |
| UI/UX 设计师 | | 待审批 | |
| 市场负责人 | | 待审批 | |

---

**文档版本**：v1.0
**创建日期**：2026-02-13
**最后更新**：2026-02-13
**文档所有者**：SpreadJS 产品团队
